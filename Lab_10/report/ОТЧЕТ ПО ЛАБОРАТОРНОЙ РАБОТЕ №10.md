![](media/image1.png){width="1.75in" height="0.6240912073490814in"}

**РОССИЙСКИЙ УНИВЕРСИТЕТ ДРУЖБЫ НАРОДОВ**

Факультет физико-математических и естественных наук\
Кафедра прикладной информатики и теории вероятностей

**ОТЧЕТ ПО ЛАБОРАТОРНОЙ РАБОТЕ № 10**

Управление модулями ядра

**Студент:** Эйвази Мани

**Группа:** НПИбд-03-24

**Студенческий билет №:** 1032245107

**Цель работы**

Получить практические навыки работы с модулями ядра операционной системы
Linux. Освоить методы загрузки, выгрузки, получения информации о
модулях, а также обновления самого ядра системы.

**Первый шаг:** Определение устройств в системе и модулей ядра, которые
их обслуживают.  Вывод команды показывает список всех PCI-устройств. Для
каждого устройства указывается драйвер (модуль ядра) в строке Kernel
driver in use: и доступные модули в строке Kernel modules: Например:

- Ethernet controller: Realtek Semiconductor Co., Ltd. \... -\> Kernel
  driver in use: r8169, Kernel modules: r8169

- Это показывает, что для сетевой карты используется модуль r8169.

![](media/image2.png){width="6.074402887139108in"
height="3.9791666666666665in"}

**Второй шаг:** Получение списка всех модулей, загруженных в ядро.
Выводится отсортированный список модулей. Каждая строка содержит имя
модуля, его размер в памяти и список модулей, которые от него зависят.
Например:

ext4 \<размер\> 2 \<зависимости\>

crc16 \<размер\> 1 ext4

![](media/image2.png){width="6.345415573053368in" height="1.90625in"}

**Третий шаг:** Поиск, загрузка и проверка состояния модуля ext4. После
выполнения modprobe ext4 модуль появляется в выводе lsmod. Это означает,
что код, отвечающий за поддержку файловой системы ext4, загружен в ядро.

![](media/image3.png){width="5.97619094488189in"
height="0.8333333333333334in"}

**Четвертый шаг**: Изучение деталей о модуле ext4. Вывод содержит
метаданные модуля:

- filename: Путь к файлу модуля на диске
  (например, /lib/modules/\.../ext4.ko.xz).

- license: GPL (лицензия).

- description: Fourth Extended Filesystem (описание).

- depends: Список модулей, от которых зависит ext4
  (например, mbcache, jbd2).

- retpoline: Y (указание на поддержку мер безопасности).

- Поля parm: отсутствуют, что означает, что модуль не принимает
  параметров при загрузке.

> **Команда:** modinfo ext4

**Пятый шаг:** Проверка возможности выгрузки модулей ext4 и xfs.

- Модуль ext4 может быть успешно выгружен (rmmod ext4 также работает),
  если в данный момент не используется (нет смонтированных разделов
  ext4).

- Модуль xfs выгрузить не удается. Система выдает ошибку: modprobe:
  FATAL: Module xfs is in use.. Это означает, что в данный момент есть
  смонтированная файловая система XFS (скорее всего, корневой раздел /),
  поэтому ядро не позволяет выгрузить необходимый для её работы драйвер.

![](media/image3.png){width="5.288477690288714in"
height="0.3645833333333333in"}

**Шестой шаг:** Исследование модуля, поддерживающего Bluetooth, и его
параметров. После загрузки bluetooth загружается целая цепочка зависимых
модулей (например, btusb, btrtl). Команда modinfo bluetooth показывает,
что у данного модуля есть параметры (parm)

![](media/image3.png){width="5.9840277777777775in"
height="1.0416666666666667in"}

**Седьмой шаг:** Определение версии текущего ядра и проверка доступных
обновлений. uname -r показывает текущую запущенную версию ядра
(например, 4.18.0-\...). dnf list kernel отображает установленную версию
и последнюю доступную в репозиториях.

![](media/image3.png){width="5.978121172353456in"
height="1.1041666666666667in"}

> **Восьмой шаг:** Полное обновление системы с установкой нового ядра.
> Пакет kernel успешно обновлен до новой версии. При этом старая версия
> ядра также остается в системе (для возможности отката).

![](media/image4.png){width="5.669229002624672in"
height="2.1979166666666665in"}![](media/image5.png){width="5.383473315835521in"
height="2.663552055993001in"}

**девяти шаг:** Перезагрузка системы (reboot). В загрузчике GRUB
автоматически выбрано новое ядро (обычно первое в списке).

- Команда проверки: uname -r

После перезагрузки команда uname -r показывает номер версии нового,
только что установленного ядра. Команда hostnamectl также отображает эту
информацию в разделе Kernel.

**заключение**

> В ходе лабораторной работы были успешно освоены ключевые аспекты
> работы с модулями ядра Linux:

1.  **Мониторинг и диагностика:** Навыки использования lspci -k для
    связи аппаратных устройств с драйверами (модулями ядра) и lsmod для
    просмотра всех загруженных модулей с их зависимостями.

2.  **Управление модулями:**

    - **Загрузка:** Команда modprobe является предпочтительным способом,
      так как она автоматически разрешает и загружает зависимости
      модуля.

    - **Выгрузка:** Команда modprobe -r (или rmmod) позволяет выгрузить
      модуль, но только если он не используется системой в данный момент
      (устройство не активно, файловая система не смонтирована).
      Получение ошибки \"Module is in use\" --- стандартное поведение,
      обеспечивающее стабильность системы.

3.  **Получение информации:** Утилита modinfo предоставляет
    исчерпывающие метаданные о модуле: описание, лицензию, автора,
    параметры (parm). Наличие параметров показывает возможность тонкой
    настройки модуля при загрузке.

4.  **Обновление ядра:** Отработан безопасный процесс обновления ядра в
    дистрибутивах на основе RHEL (Rocky Linux):

    - Обновление репозиториев и всех пакетов.

    - Установка нового пакета kernel. Важно, что это не заменяет, а
      добавляет новую версию ядра.

> Работа продемонстрировала модульность ядра Linux, где функциональность
> может динамически расширяться по мере необходимости. Понимание
> принципов работы с модулями критически важно для системного
> администратора при подключении нового оборудования, отладке проблем с
> драйверами и обновлении системного ПО.

1.  Какая команда показывает текущую версию ядра, которая используется
    на вашей системе?

> uname -r (только версия) или uname -a (вся информация).

2.  Как можно посмотреть более подробную информацию о текущей версии
    ядра операционной системы?

> hostnamectl (показывает среди прочего версию ядра) или cat
> /proc/version.

3.  Какая команда показывает список загруженных модулей ядра?

> lsmod.

4.  Какая команда позволяет вам определять параметры модуля ядра?

> modinfo \<имя_модуля\>. Параметры перечислены в секции parm.

5.  Как выгрузить модуль ядра?

> modprobe -r \<имя_модуля\> или rmmod \<имя_модуля\>. modprobe
> -r предпочтительнее, так как пытается выгрузить и зависимости.

6.  Что вы можете сделать, если получите сообщение об ошибке при попытке
    выгрузить модуль ядра?

> Ошибка Module is in use означает, что модуль используется системой.
> Необходимо остановить использование: для сетевого драйвера ---
> выключить интерфейс (ip link set \<iface\> down), для файловой системы
> --- размонтировать раздел (umount /dev/sdX). После этого выгрузка
> станет возможна.

7.  Как определить, какие параметры модуля ядра поддерживаются?

> С помощью команды modinfo \<имя_модуля\> и просмотра строк,
> начинающихся с parm:.

8.  Как установить новую версию ядра?

> В дистрибутивах на основе RPM (RHEL, CentOS, Rocky, Fedora): dnf
> update kernel или установка конкретного пакета ядра. После установки
> необходима перезагрузка для запуска с новым ядром.
